)
ipums_df <- ipums_df %>% left_join(region_table, by = "iso_2")
rhomis_df <- rhomis_df %>% left_join(region_table, by = "iso_2")
# Chunk 4: leaflet_map
mapviewOptions(fgb = FALSE) # needed when creating web pages
# mapview(ipums_geo,fgb = FALSE, basemaps="OpenStreetMap.Mapnik")
map <- mapview(rhomis_geo_data$geometry, alpha=0.5, col.regions="black",color="white", burst=T)+
mapview(ipums_geo$geometry,
alpha=1,
color="black",
col.regions = "green",
alpha.regions=0.3, burst=T)
map
# Chunk 6
par(mar = c(4, 4, .1, .1))
households_per_country <- rhomis_df %>%
filter(!is.na(iso_2)) %>%
group_by(iso_2) %>%
summarise(
number_of_households=dplyr::n()
)
households_per_country <- households_per_country %>% left_join(region_table, by="iso_2")
ggplot(households_per_country, aes(x=iso_2, y=number_of_households, fill=region_afr))+
geom_bar(stat="identity")+
labs(title="Number of RHoMIS Surveys by Country",
x ="ISO Country Code", y = "Number RHoMIS Surveys")
areas_in_rhomis <- ipums_df %>%
# Select columns
select(c("iso_2", "GEOID_country", "GEO2LABEL")) %>%
# Add a True/False column, whether the GEOID is in RHoMIS
mutate(
in_rhomis = ipums_df$GEOID_country %in% rhomis_df$GEOID_country,
) %>%
group_by(iso_2) %>%
# Get the country summary of number of areas, and nuber of rhomis areas
summarise(
number_of_GEO2=dplyr::n(),
GEO2_with_rhomis=sum(in_rhomis==T)
) %>%
# Calculate the percentage of areas covered
mutate(
coverage = 100*GEO2_with_rhomis/number_of_GEO2,
)
areas_in_rhomis <- areas_in_rhomis %>% left_join(region_table, by="iso_2")
ggplot(areas_in_rhomis, aes(x=iso_2, y=coverage, fill=region_afr))+
geom_bar(stat="identity")+
labs(title="Percentage of GEO2 Areas Containing RHoMIS Surveys",
x ="ISO Country Code", y = "Percentage of Areas with RHoMIS Surveys")
# knitr::kable(areas_in_rhomis)
# stats_per_area <- rhomis_df %>%
#   group_by(iso_2, GEO2LABEL) %>%
#   summarise(
#     households_per_area=dplyr::n()
#   ) %>%
#   group_by(iso_2) %>%
#   summarise(
#     hh_per_geo2_mean=mean(households_per_area),
#     hh_per_geo2_lq=quantile(households_per_area, 0.25, na.rm=T),
#     hh_per_geo2_median=quantile(households_per_area, 0.5, na.rm=T),
#     hh_per_geo2_uq=quantile(households_per_area, 0.75, na.rm=T),
#     hh_per_geo2_iqr=IQR(households_per_area, 0.75, na.rm=T),
#
#     hh_per_geo2_sd=sd(households_per_area)
#
#   )
stats_per_area <- rhomis_df %>%
filter(!is.na(iso_2))%>%
group_by(iso_2, GEO2LABEL) %>%
summarise(
households_per_area=dplyr::n()
)
stats_per_area <- stats_per_area %>% left_join(region_table, by="iso_2")
ggplot(stats_per_area, aes(x=iso_2, y=households_per_area, fill=region_afr))+
geom_violin(scale="width")+
labs(title="Number of RHoMIS Surveys in GEO2 Households",
x ="ISO Country Code", y = "Number of Households in Area")
# Chunk 7: land_size_1
rhomis_no_na <- rhomis_df %>%
filter(!is.na(iso_2)) %>%
filter(!is.na(land_cultivated_ha)) %>%
filter(total_income_ppp_per_year>=0)
rhomis_no_na <- bin_and_quantile(rhomis_no_na, 10, "land_cultivated_ha")
rhomis_no_na <- rhomis_no_na %>% rename(land_quantiles=quantiles)
rhomis_no_na <- rhomis_no_na %>% rename(land_quantile_centers=quantile_center)
ggplot(rhomis_no_na, aes(x=land_quantiles, y=total_income_ppp_per_year)) +
geom_violin(scale="width")+
scale_y_continuous(limits = quantile(rhomis_no_na$total_income_ppp_per_year, c(0, 0.8), na.rm = T))+
labs(title="Total Income for 10 Land Size Quantiles",
x ="Land Size Quantile", y = "Total Household Income (PPP$/Year)")
rhomis_no_na$livestock_tlu[rhomis_no_na$livestock_tlu<0] <- NA
ggplot(rhomis_no_na, aes(x=land_quantiles, y=livestock_tlu)) +
geom_violin(scale="width")+
scale_y_continuous(limits = quantile(rhomis_no_na$livestock_tlu, c(0, 0.9), na.rm = T))+
labs(title="Livestock TLU for 10 Land Size Quantiles",
x ="Land Size Quantile", y = "Livestock TLU")
# Chunk 8: land_size_2
ggplot(rhomis_no_na, aes(x=iso_2, y=land_cultivated_ha, fill=region_afr))+
geom_violin(scale="width")+
scale_y_continuous(limits = quantile(rhomis_df$land_cultivated_ha, c(0, 0.95), na.rm = T))+
labs(title="Land Cultivated (ha) per Country",
x ="ISO Country Code", y = "Land Cultivated (ha)")
# Chunk 9: land_size_3
land_size_stats <- rhomis_no_na %>%
group_by(GEOID_country) %>%
summarise(
mean_land_cultivated_ha = mean(land_cultivated_ha, na.rm=T),
sd_land_cultivated_ha = stats::sd(land_cultivated_ha, na.rm=T),
median_land_cultivated_ha = median(land_cultivated_ha, na.rm=T),
iqr_land_cultivated_ha = IQR(land_cultivated_ha, na.rm=T),
skew_land_cultivated_ha = moments::skewness(land_cultivated_ha, na.rm=T),
kurtosis_land_cultivated_ha = moments::kurtosis(land_cultivated_ha, na.rm=T)
)
land_size_stats$coeff_of_variation <- land_size_stats$sd_land_cultivated_ha/land_size_stats$mean_land_cultivated_ha
land_size_stats$quartcoeff_of_variation <- land_size_stats$iqr_land_cultivated_ha/land_size_stats$median_land_cultivated_ha
land_size_stats <- land_size_stats %>% left_join(unique(rhomis_no_na[c("iso_2","GEOID_country","region_afr" )]), by="GEOID_country")
ggplot(land_size_stats, aes(x=mean_land_cultivated_ha, y=coeff_of_variation, color=region_afr))+
geom_point()+
scale_y_continuous(limits = quantile(land_size_stats$coeff_of_variation, c(0, 0.95), na.rm = T))+
scale_x_continuous(limits = quantile(land_size_stats$mean_land_cultivated_ha, c(0, 0.95), na.rm = T))+
labs(title="Mean Land Cultivated vs Coefficient of Variation\nper GEOID (Subnational Level 2)",
x ="Mean Land Cultivated (ha)", y = "Std Dev Land Cultivated", color="Country")
ggplot(land_size_stats, aes(x=median_land_cultivated_ha, y=quartcoeff_of_variation, color=region_afr))+
geom_point()+
scale_y_continuous(limits = quantile(land_size_stats$quartcoeff_of_variation, c(0, 0.95), na.rm = T))+
scale_x_continuous(limits = quantile(land_size_stats$median_land_cultivated_ha, c(0, 0.95), na.rm = T))+
labs(title="Median Cultivated vs Quartile Based Coefficient of Variation \nper GEOID (Subnational Level 2)",
x ="Median Land Cultivated (ha)", y = "IQR Land Cultivated", color="Country")
ggplot(land_size_stats, aes(x=skew_land_cultivated_ha))+
geom_histogram(fill="dodgerblue4", color="black", size=0.5)+
scale_x_continuous(limits = quantile(land_size_stats$skew_land_cultivated_ha, c(0, 0.95), na.rm = T))+
labs(title="Skewness of Land Cultivated per GEOID",
x ="Skewness", y = "Frequency")
ggplot(land_size_stats, aes(x=kurtosis_land_cultivated_ha))+
geom_histogram(fill="dodgerblue4", color="black", size=0.5)+
scale_x_continuous(limits = quantile(land_size_stats$kurtosis_land_cultivated_ha, c(0, 0.95), na.rm = T))+
labs(title="Kurtosis of Land Cultivated per GEOID",
x ="Kurtosis", y = "Frequency")
mean_vs_threshold <- rhomis_no_na %>%
filter(land_cultivated_ha < quantile(land_cultivated_ha, 0.95, na.rm=T)) %>%
group_by(GEOID_country) %>%
summarise(
mean_land_cultivated = mean(land_cultivated_ha, na.rm=T),
number_below_2_ha = sum(land_cultivated_ha<2),
quantile_0.1 = quantile(land_cultivated_ha,0.1),
number_of_hh = dplyr::n()) %>%
mutate(
proportion_below_threshold = number_below_2_ha/number_of_hh,
)
mean_vs_threshold <- mean_vs_threshold %>% left_join(unique(rhomis_no_na[c("iso_2","GEOID_country","region_afr" )]), by="GEOID_country")
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"mean_land_cultivated")
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantiles=quantiles)
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantile_center=quantile_center)
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"proportion_below_threshold")
mean_vs_threshold <- mean_vs_threshold %>% rename(proportion_below_threshold_quantiles=quantiles)
mean_vs_threshold <- mean_vs_threshold %>% rename(proportion_below_threshold_quantile_center=quantile_center)
mean_vs_threshold <- mean_vs_threshold[complete.cases(mean_vs_threshold),]
mean_v_threshold_quantiles <- mean_vs_threshold %>%
group_by(mean_land_cultivated_quantiles) %>%
summarise(max_vulnerable = max(proportion_below_threshold),
min_vulnerable = min(proportion_below_threshold))
mean_v_threshold_quantiles <- mean_v_threshold_quantiles %>%
merge(mean_vs_threshold[c("mean_land_cultivated_quantiles","mean_land_cultivated_quantile_center")],
by = "mean_land_cultivated_quantiles", all.x=T, all.y=F)
mean_v_threshold_quantiles <- mean_v_threshold_quantiles[duplicated(mean_v_threshold_quantiles)==F,]
mean_v_threshold_quantiles$xlow <- mean_v_threshold_quantiles$mean_land_cultivated_quantile_center-0.25
mean_v_threshold_quantiles$xhigh <- mean_v_threshold_quantiles$mean_land_cultivated_quantile_center+0.25
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable)) +
# coord_flip() +
#
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
x ="Mean Land Cultivated", y = "Proportion of Households <2ha")
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
# geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable)) +
# coord_flip() +
#
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
x ="Mean Land Cultivated", y = "Proportion of Households <2ha")
mean_v_threshold_quantiles$max_vulnerable
ggplot()+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable))
?geom_segment
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable),  inherit.aes = F) +
# coord_flip() +
#
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
x ="Mean Land Cultivated", y = "Proportion of Households <2ha")
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = min_vulnerable, xend = xhigh, yend = min_vulnerable),  inherit.aes = F) +
# coord_flip() +
#
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
x ="Mean Land Cultivated", y = "Proportion of Households <2ha")
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = min_vulnerable, xend = xhigh, yend = min_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = mean_land_cultivated_quantile_center, y = max_vulnerable, xend = mean_land_cultivated_quantile_center, yend = min_vulnerable),  inherit.aes = F)
rhomis_no_na$total_income_ppp_per_year
rhomis_no_na$ppp_per_mae <- rhomis_no_na$total_income_ppp_per_year/rhomis_no_na$hh_size_mae
rhomis_no_na$ppp_per_mae
mean_vs_threshold <- rhomis_no_na %>%
filter(land_cultivated_ha < quantile(land_cultivated_ha, 0.95, na.rm=T)) %>%
filter(!is.na(ppp_per_mae)) %>%
group_by(GEOID_country) %>%
summarise(
mean_land_cultivated = mean(land_cultivated_ha, na.rm=T),
number_below_2_ha = sum(land_cultivated_ha<2),
quantile_0.1 = quantile(land_cultivated_ha,0.1),
number_of_hh = dplyr::n()) %>%
mutate(
proportion_below_threshold = number_below_2_ha/number_of_hh,
)
mean_vs_threshold
rhomis_no_na$ppp_per_mae <- rhomis_no_na$total_income_ppp_per_year/rhomis_no_na$hh_size_mae
mean_vs_threshold <- rhomis_no_na %>%
filter(land_cultivated_ha < quantile(land_cultivated_ha, 0.95, na.rm=T)) %>%
filter(!is.na(ppp_per_mae)) %>%
group_by(GEOID_country) %>%
summarise(
mean_land_cultivated = mean(land_cultivated_ha, na.rm=T),
number_below_2_ha = sum(land_cultivated_ha<2),
quantile_0.1 = quantile(land_cultivated_ha,0.1),
ppp_per_mae_less_1.90 = sum(ppp_per_mae<1.90)
number_of_hh = dplyr::n()) %>%
mutate(
proportion_below_land_threshold = number_below_2_ha/number_of_hh,
proportion_below_poverty_threshold = ppp_per_mae_less_1.90/number_of_hh
)
mean_vs_threshold <- rhomis_no_na %>%
filter(land_cultivated_ha < quantile(land_cultivated_ha, 0.95, na.rm=T)) %>%
filter(!is.na(ppp_per_mae)) %>%
group_by(GEOID_country) %>%
summarise(
mean_land_cultivated = mean(land_cultivated_ha, na.rm=T),
number_below_2_ha = sum(land_cultivated_ha<2),
quantile_0.1 = quantile(land_cultivated_ha,0.1),
ppp_per_mae_less_1.90 = sum(ppp_per_mae<1.90),
number_of_hh = dplyr::n()) %>%
mutate(
proportion_below_land_threshold = number_below_2_ha/number_of_hh,
proportion_below_poverty_threshold = ppp_per_mae_less_1.90/number_of_hh
)
mean_vs_threshold <- mean_vs_threshold %>% left_join(unique(rhomis_no_na[c("iso_2","GEOID_country","region_afr" )]), by="GEOID_country")
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"mean_land_cultivated")
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantiles=quantiles)
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantile_center=quantile_center)
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"proportion_below_threshold")
mean_vs_threshold <- mean_vs_threshold %>% rename(proportion_below_threshold_quantiles=quantiles)
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"mean_land_cultivated")
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantiles=quantiles)
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantile_center=quantile_center)
mean_vs_threshold <- rhomis_no_na %>%
filter(land_cultivated_ha < quantile(land_cultivated_ha, 0.95, na.rm=T)) %>%
filter(!is.na(ppp_per_mae)) %>%
group_by(GEOID_country) %>%
summarise(
mean_land_cultivated = mean(land_cultivated_ha, na.rm=T),
number_below_2_ha = sum(land_cultivated_ha<2),
quantile_0.1 = quantile(land_cultivated_ha,0.1),
ppp_per_mae_less_1.90 = sum(ppp_per_mae<1.90),
number_of_hh = dplyr::n()) %>%
mutate(
proportion_below_land_threshold = number_below_2_ha/number_of_hh,
proportion_below_poverty_threshold = ppp_per_mae_less_1.90/number_of_hh
)
mean_vs_threshold <- mean_vs_threshold %>% left_join(unique(rhomis_no_na[c("iso_2","GEOID_country","region_afr" )]), by="GEOID_country")
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"mean_land_cultivated")
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantiles=quantiles)
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantile_center=quantile_center)
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"proportion_below_threshold")
mean_vs_threshold <- mean_vs_threshold %>% rename(proportion_below_threshold_quantiles=quantiles)
rhomis_no_na$ppp_per_mae <- rhomis_no_na$total_income_ppp_per_year/rhomis_no_na$hh_size_mae
mean_vs_threshold <- rhomis_no_na %>%
filter(land_cultivated_ha < quantile(land_cultivated_ha, 0.95, na.rm=T)) %>%
filter(!is.na(ppp_per_mae)) %>%
group_by(GEOID_country) %>%
summarise(
mean_land_cultivated = mean(land_cultivated_ha, na.rm=T),
number_below_2_ha = sum(land_cultivated_ha<2),
quantile_0.1 = quantile(land_cultivated_ha,0.1),
ppp_per_mae_less_1.90 = sum(ppp_per_mae<1.90),
number_of_hh = dplyr::n()) %>%
mutate(
proportion_below_land_threshold = number_below_2_ha/number_of_hh,
proportion_below_poverty_threshold = ppp_per_mae_less_1.90/number_of_hh
)
mean_vs_threshold <- mean_vs_threshold %>% left_join(unique(rhomis_no_na[c("iso_2","GEOID_country","region_afr" )]), by="GEOID_country")
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"mean_land_cultivated")
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantiles=quantiles)
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantile_center=quantile_center)
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"proportion_below_land_threshold")
mean_vs_threshold <- mean_vs_threshold %>% rename(proportion_below_threshold_quantiles=quantiles)
mean_vs_threshold <- mean_vs_threshold %>% rename(proportion_below_threshold_quantile_center=quantile_center)
mean_vs_threshold <- mean_vs_threshold[complete.cases(mean_vs_threshold),]
mean_v_threshold_quantiles <- mean_vs_threshold %>%
group_by(mean_land_cultivated_quantiles) %>%
summarise(max_vulnerable = max(proportion_below_land_threshold),
min_vulnerable = min(proportion_below_land_threshold))
mean_v_threshold_quantiles <- mean_v_threshold_quantiles %>%
merge(mean_vs_threshold[c("mean_land_cultivated_quantiles","mean_land_cultivated_quantile_center")],
by = "mean_land_cultivated_quantiles", all.x=T, all.y=F)
mean_v_threshold_quantiles <- mean_v_threshold_quantiles[duplicated(mean_v_threshold_quantiles)==F,]
mean_v_threshold_quantiles$xlow <- mean_v_threshold_quantiles$mean_land_cultivated_quantile_center-0.25
mean_v_threshold_quantiles$xhigh <- mean_v_threshold_quantiles$mean_land_cultivated_quantile_center+0.25
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_land_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_land_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = min_vulnerable, xend = xhigh, yend = min_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = mean_land_cultivated_quantile_center, y = max_vulnerable, xend = mean_land_cultivated_quantile_center, yend = min_vulnerable),  inherit.aes = F)
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_land_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_land_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = min_vulnerable, xend = xhigh, yend = min_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = mean_land_cultivated_quantile_center, y = max_vulnerable, xend = mean_land_cultivated_quantile_center, yend = min_vulnerable),  inherit.aes = F) +
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
x ="Mean Land Cultivated", y = "Proportion of Households <2ha")
ggplot(
mean_vs_threshold,
aes(x=proportion_below_land_threshold,y=mean_land_cultivated_quantile_center, group=mean_land_cultivated_quantile_center, color=region_afr))+
stat_density_ridges(bandwidth = 0.07,
scale = 0.5,
size = 0.25,
rel_min_height = 0.04
) +
geom_point(data=mean_vs_threshold, aes(y=mean_land_cultivated, x=proportion_below_land_threshold))+
geom_smooth(data=mean_vs_threshold,
method="glm",
method.args = list(family = "binomial"),
se=F,
aes(y=mean_land_cultivated, x=proportion_below_land_threshold,group=NULL, color=NULL))+
coord_flip() +
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
y ="Mean Land Cultivated", x = "Proportion of Households <2ha")
mean_v_threshold_quantiles_poverty$xlow <- mean_v_threshold_quantiles_poverty$mean_land_cultivated_quantile_center-0.25
mean_v_threshold_quantiles_poverty <- mean_vs_threshold %>%
group_by(mean_land_cultivated_quantiles) %>%
summarise(max_vulnerable = max(proportion_below_poverty_threshold),
min_vulnerable = min(proportion_below_poverty_threshold))
mean_v_threshold_quantiles_poverty <- mean_v_threshold_quantiles_poverty %>%
merge(mean_vs_threshold[c("mean_land_cultivated_quantiles","mean_land_cultivated_quantile_center")],
by = "mean_land_cultivated_quantiles", all.x=T, all.y=F)
mean_v_threshold_quantiles_poverty <- mean_v_threshold_quantiles_poverty[duplicated(mean_v_threshold_quantiles_poverty)==F,]
mean_v_threshold_quantiles_poverty$xlow <- mean_v_threshold_quantiles_poverty$mean_land_cultivated_quantile_center-0.25
mean_v_threshold_quantiles_poverty$xhigh <- mean_v_threshold_quantiles_poverty$mean_land_cultivated_quantile_center+0.25
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_land_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_land_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = min_vulnerable, xend = xhigh, yend = min_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = mean_land_cultivated_quantile_center, y = max_vulnerable, xend = mean_land_cultivated_quantile_center, yend = min_vulnerable),  inherit.aes = F) +
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
x ="Mean Land Cultivated", y = "Proportion of Households <2ha")
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_poverty_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_land_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = min_vulnerable, xend = xhigh, yend = min_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = mean_land_cultivated_quantile_center, y = max_vulnerable, xend = mean_land_cultivated_quantile_center, yend = min_vulnerable),  inherit.aes = F) +
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
x ="Mean Land Cultivated", y = "Proportion of Households <2ha")
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_poverty_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_poverty_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = min_vulnerable, xend = xhigh, yend = min_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = mean_land_cultivated_quantile_center, y = max_vulnerable, xend = mean_land_cultivated_quantile_center, yend = min_vulnerable),  inherit.aes = F) +
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
x ="Mean Land Cultivated", y = "Proportion of Households <2ha")
ggplot(mean_vs_threshold,aes(x=mean_vs_threshold))+
geom_hist()
ggplot(mean_vs_threshold,aes(x=mean_vs_threshold))+
geom_histogram()
mean_vs_threshold
ggplot(mean_vs_threshold,aes(x=proportion_below_poverty_threshold))+
geom_histogram()
ggplot(rhomis_no_na,aes(x=ppp_per_mae))+
geom_histogram()
rhomis_no_na$ppp_per_mae
colnames(rhomis_no_na)
mean_vs_threshold <- rhomis_no_na %>%
filter(land_cultivated_ha < quantile(land_cultivated_ha, 0.95, na.rm=T)) %>%
filter(!is.na(ppp_per_mae)) %>%
group_by(GEOID_country) %>%
summarise(
mean_land_cultivated = mean(land_cultivated_ha, na.rm=T),
number_below_2_ha = sum(land_cultivated_ha<2),
quantile_0.1 = quantile(land_cultivated_ha,0.1),
number_of_hh = dplyr::n()) %>%
mutate(
proportion_below_land_threshold = number_below_2_ha/number_of_hh,
)
mean_vs_threshold <- mean_vs_threshold %>% left_join(unique(rhomis_no_na[c("iso_2","GEOID_country","region_afr" )]), by="GEOID_country")
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"mean_land_cultivated")
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantiles=quantiles)
mean_vs_threshold <- mean_vs_threshold %>% rename(mean_land_cultivated_quantile_center=quantile_center)
mean_vs_threshold <- bin_and_quantile(mean_vs_threshold,5,"proportion_below_land_threshold")
mean_vs_threshold <- mean_vs_threshold %>% rename(proportion_below_threshold_quantiles=quantiles)
mean_vs_threshold <- mean_vs_threshold %>% rename(proportion_below_threshold_quantile_center=quantile_center)
mean_vs_threshold <- mean_vs_threshold[complete.cases(mean_vs_threshold),]
mean_v_threshold_quantiles <- mean_vs_threshold %>%
group_by(mean_land_cultivated_quantiles) %>%
summarise(max_vulnerable = max(proportion_below_land_threshold),
min_vulnerable = min(proportion_below_land_threshold))
mean_v_threshold_quantiles <- mean_v_threshold_quantiles %>%
merge(mean_vs_threshold[c("mean_land_cultivated_quantiles","mean_land_cultivated_quantile_center")],
by = "mean_land_cultivated_quantiles", all.x=T, all.y=F)
mean_v_threshold_quantiles <- mean_v_threshold_quantiles[duplicated(mean_v_threshold_quantiles)==F,]
mean_v_threshold_quantiles$xlow <- mean_v_threshold_quantiles$mean_land_cultivated_quantile_center-0.25
mean_v_threshold_quantiles$xhigh <- mean_v_threshold_quantiles$mean_land_cultivated_quantile_center+0.25
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_land_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_land_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = min_vulnerable, xend = xhigh, yend = min_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = mean_land_cultivated_quantile_center, y = max_vulnerable, xend = mean_land_cultivated_quantile_center, yend = min_vulnerable),  inherit.aes = F) +
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
x ="Mean Land Cultivated", y = "Proportion of Households <2ha")
ggplot(
mean_vs_threshold,
aes(x=mean_land_cultivated,y=proportion_below_poverty_threshold, color=region_afr))+
geom_point()+
geom_smooth(
method="glm",
method.args = list(family = "binomial"),
se=T,
aes(y=proportion_below_poverty_threshold, x=mean_land_cultivated,group=NULL, color=NULL))+
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = max_vulnerable, xend = xhigh, yend = max_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = xlow, y = min_vulnerable, xend = xhigh, yend = min_vulnerable),  inherit.aes = F) +
geom_segment(data=mean_v_threshold_quantiles, mapping=aes(x = mean_land_cultivated_quantile_center, y = max_vulnerable, xend = mean_land_cultivated_quantile_center, yend = min_vulnerable),  inherit.aes = F) +
labs(title="Mean Land Cultivated vs Prop of Households with <2ha of Land",
x ="Mean Land Cultivated", y = "Proportion of Households <2ha")
mean_v_threshold_quantiles
